apiVersion: compute.appvia.io/v2beta2
kind: ComputeTemplate
metadata:
  name: aks-strict-multitenant
spec:
  description: Separate system and user node pools for hardened configuration with quota-limits for multi-tenant clusters
  provider: AKS

  nodePools:
  - diskSize: 60
    autoscaling:
      enabled: true
      maxSize: 10
      minSize: 2
    image: Linux
    machine: Standard_D2s_v5
    maxPodsPerNode: 50
    logicalName: system
    size: 2
    providerDetails:
      aks:
        mode: system
    taints:
    - effect: NoSchedule
      key: CriticalAddonsOnly
      value: "true"
  - diskSize: 30
    autoscaling:
      enabled: true
      maxSize: 10
      minSize: 1
    image: Linux
    machine: Standard_D2s_v5
    maxPodsPerNode: 110
    logicalName: compute
    size: 1
    providerDetails:
      aks:
        mode: user

  quotaLimits:
    default: small
    templates:
    - name: small
      constraints:
        hardQuota:
          "requests.cpu": "1"
          "requests.memory": "3.5Gi"
        limitRanges:
        - type: Pod
          max:
            "cpu": "256m"
            "memory": "896Mi"
            "ephemeral-storage": "2.175Gi"
      resourceDefaults:
      - type: Container
        default:
          "cpu": "256m"
          "memory": "896Mi"
          "ephemeral-storage": "10Mi"
        defaultRequest:
          "cpu": "50m"
          "memory": "200Mi"
    - name: medium
      constraints:
        hardQuota:
          "requests.cpu": "2"
          "requests.memory": "7Gi"
        limitRanges:
        - type: Pod
          max:
            "cpu": "512m"
            "memory": "1792Mi"
            "ephemeral-storage": "4.35Gi"
      resourceDefaults:
      - type: Container
        default:
          "cpu": "512m"
          "memory": "1792Mi"
          "ephemeral-storage": "500Mi"
        defaultRequest:
          "cpu": "50m"
          "memory": "200Mi"
    - name: large
      constraints:
        hardQuota:
          "requests.cpu": "4"
          "requests.memory": "14Gi"
        limitRanges:
        - type: Pod
          max:
            "cpu": "1"
            "memory": "3584Mi"
            "ephemeral-storage": "8.7Gi"
      resourceDefaults:
      - type: Container
        default:
          "cpu": "1"
          "memory": "3584Mi"
          "ephemeral-storage": "1Gi"
        defaultRequest:
          "cpu": "50m"
          "memory": "200Mi"
